---
layout: post
title: Iam aws
lang: fr
permalink: /fr/iam-aws/
excerpt: "L'une des étapes incontournable sur Amazon web service est de bien comprendre le service IAM (Identity and Acess Management). C'est l'un des services les plus important car il permet de gérer les utilisateurs où service qui peuvent avoir accès à votre compte AWS.
Nous allons essayer de comprendre comme fonctionne ce service."
authors:
    - captainjojo
categories:
    - aws
tags:
    - cloud
cover: /assets/2018-03-28-graphql-kesako/cover.jpeg
---

L'une des étapes incontournable sur Amazon web service est de bien comprendre le service IAM (Identity and Acess Management). C'est l'un des services les plus important car il permet de gérer les utilisateurs où service qui peuvent avoir accès à votre compte AWS.
Nous allons essayer de comprendre comme fonctionne ce service.

## Introduction

IAM permet de donner des droits très fin à un utilisateur, un utilisateur pouvant être une machine. L'idée est de donnée par exemple accès aux service S3 seulement en lecture pour un utilisateur donnée pendant 1h le 2 janvier. C'est ce que permet IAM.

C'est le point central de votre sécurité, il permet de gérer l'ensemble des accès sécurisé de votre business.

AWS nous donne aussi la définition de ce qu'IAM n'est pas:

- Ne permet pas de gérer les permissions de vos applications. IAM ne sert que pour les permissions de vos services AWS.
- IAM n'est pas un OS de management d'identité type LDAP, ou active directory.

## Les principes

### Utilisateur racine (Root User)

Lors de la création de votre compre AWS, vous avez créé un compte racine (Root User). C'est le compte avec le plus de permission possible, il est le propriétaire du compte, il peut s'il le souhaite supprimer le compte.

Attention ce compte étant le compte principal il faut absolument le sécurisé fortement avec un Multi-factor Application (Doucle authentification).

Il est déconseillé d'utiliser ce user tout les jours, car il à trop d'accès, c'est un peu comme être en ROOT sur votre machine UNIX toute la journée. Le mieux est de créer un utilisateur IAM, comme vous pouvez le voir dans le chapitre suivant.

### Utilisateur IAM

Un utilisateur IAM représente une personnes physique ou un application. Vous devez créer un utilisateur différents pour tout les membre de votre équipe qui doivent utilisé des services AWS. Il est important de correctement séparé leurs droits ce qui permet de sécurisé chaque service de votre compte AWS.

Un utilisateur peut se créer via la console AWS ou directement en CLI, nous le verons plus tard.

Il est possible de définir des droits très fin pour un utilisateur, si vous souhaitez qu'un utilisateur ai les même droits qu'un autre la notions de groupes est important.

### Groupes

Un groupes est un object qui permet de définir des droits pour un ensemble d'utilisateur. L'idée est d'avoir un groupes d'utilisateur ayant exactement les même droits cela permet de centraliser vos configuration de droits.
L'un des groupes est par exemple 'developpeur' vous pouvez alors donner des droits spécifique à tous vos développeurs.

### Roles

Les roles permettent de donner acccès à des services spécifique pendant un temps donnée. C'est souvent assez confusant avec les utilisateurs.
Les roles ont quatre utilisations :
- Donner des accès à un autre compte AWS
- Donner des accès à un compte externe
- Donner des accès à vos services à une application EC2 ou autre
- Donner des accès à un système de fédération

#### Accès entre compte (Cross-account)

Permet de donner des accès à un utilisateur venant d'un autre compte AWS. C'est souvent fait qu'un société externe puissent avoir àcces a un bucket par exemple.

#### Compte externe

Comme pour le cross-account, cela permet de donner des accès à une personne via son identité :
- Google
- Facebook
- Amazon

#### Accès à un service

Il est souvent necessaire de donner un accès à d'autre service AWS à une application installater sur un autre service AWS. Par exmple si une machine EC2 doit avoir accès à un bucket en lecture. Il serait possible de le faire via l'api mais cela est plus compliqué pour les développeur et demenderai d'envoyer la clé sur l'ensemble des machines. Avec ce système il suffit de donner le roles lors de l'instalation des machines et l'accès est ouvert.

#### Fédération

La fédération permet de donner accès au utilisateur de votre provider d'identité via l'utilisation d'une configuration SAML 2.0 que vous transmettez à AWS. Cela permet donc d'utiliser vos utilisateurs Active Directory ou LDAP par exemple.

## Authentification

Il exeiste 3 types d'authentification sur IAM.

La première Username/Password est la plus simple elle permet de se connecter via un login/password. IAM conseil de mettre en place une politique de mot de passe personnalisé. Vous pouvez alors choisir plusieurs options:
- Nombre de caractère
- Nombre de caractère numerique
- Changement de mot de passe tout les X jours
- etc ...

La seconde est access key/secret key, il s'agit d'une paire clé/secret qui permet de se connecter au SDK AWS. Cela vous permet d'utiise AWS cli ainsi que l'api REST disponible par AWS.

La dernière est un mélange de access key  et session key, ceci est utilisé dans le cas des roles et permet à l'utilisateur d'utiliser les services AWS via l'api REST.

## Authorisation

Une fois l'authentification effectué sur IAM, il faut donné des accès à vos utilisateurs c'est dans ce cadre que l'authorisation est appliqué. Il s'agit alors de donner des accès spécifique à chaque utilisateur. Pour ce faire nous utlisons les "policies" qui permettent de donner des droits très fin sur les services.

### Policies

Il existe déjà beaucoup de "policies" créer par AWS. Vous pouvez choisir très rapidement des "policies" du type :
- Lecture sur Bucket
- Ecriture Lambda

Mais il est possible de créer ça propre "policies" pour cela il faut créer un objet JSON. Cet objet doit contenir les infos suivantes :

- `Effect` qui contient la valeur `Allow` ou `Deny`
- `Resource` contient l'ARN de la ressource utilisé sur la "policies"
- `Action` est une liste d'action possible representé par `Service:Action`
- `Condition` Permet de mettre une condition à notre "policies" exemple l'IP est

Cela donne un objet :

```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "Stmt2649856320145",
"Effect": "Allow",
"Action": [
"s3:GetObject",
"s3:ListBucket"
],
"Condition": {
"IpAddress": {
"aws:SourceIp": "192.168.0.1"
}
},
"Resource": [
"arn:aws:s3::my_public_bucket/*"
]
}
]
}
```

Une fois votre "policies" créé vous pouvez la mettre soit sur un utilisateur IAM soit sur un groupe.

## Autre feature

Bien sur IAM a d'autre fonctionnalités très importantes.
La première est la gestion du MFA (Multi-factor authentification) permet d'utliser une autre source d'authentification pour un utilisateur IAM. Vous pouvez très facilement ajouter la double authentification via Authenticator Google.

La seconde fonctionnalité est la rotation des clés d'accès. Le veillement d'une clé d'accès augmente l'insécurité, elle peut ne plus être utilisé ou alors être utilisé sur des machine ancienne. Via AWS il est possible de générer une nouvelle clé pour un utilisateur IAM. Cela permet de désactiver l'ancienne et de créer une nouvelle avec les même droits.

La derniere est de resoudre les multis permission. C'est AWS qui s'occupe de calculé la bonne permission en utilisant l'ensemble des policies configurer pour l'utilisateur.


